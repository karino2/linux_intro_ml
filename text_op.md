---
title: "テキスト処理関連（grep, sed, awkなど)"
layout: page
---

機械学習では大きなファイルをちょっと切り出す、みたいな事が結構必要になるので、意外と変な知識を要求される。
その分ちょっとした事は諦めてPython使えば良いのでそういうのはやらない。

### grep入門

grepの入門は以下を読む。

- [grep tutorial](http://qpeng.org/computer/grep.htm)
- [Learning to Use Regular Expressions](http://gnosis.cx/publish/programming/regular_expressions.html)

正規表現はこのページで共通して使うのでちょっと大変でも頑張って読もう。

## sed入門

sedは正規表現にマッチした部分を置換するコマンドです。

sedは非常に高機能ですが、機械学習の実務ではセットアップのシェルスクリプトなどでsコマンドを使う程度なので、そこだけ覚えればいいでしょう。
使い方は以下です。

```
sed 's/正規表現/置き換える文字/'
```

置き換える対象は標準入力からとります。普通はパイプで使います。

一行読んでは正規表現にマッチするかテストし、マッチしたらそこを置き換えます。マッチしなかったらそのままその行を出力します。

sは置換をする、というコマンドでs以外にも様々な物がありますが、機械学習では使いません。
少し例を見てみましょう。

例.

```
$ echo "/some/data/0/0001.jpg" | sed 's/\.[a-z]*/.dat/'
/some/data/0/0001.dat
```

なお、sedの/の部分は、別の文字に変える事も出来ます。URLやパスなどでスラッシュにマッチさせたい時に便利です。
例えば `sed 's|正規表現|置き換える文字|'` でも良いです（私はこの縦棒を良く使います）。

例.

```
$ echo "/some/data/0/0001.jpg" | sed 's|/[^/]*$|/catalog.json|'
/some/data/0/catalog.json
```

### 範囲指定

デフォルトでは全ての行に対して一行一行処理していきますが、処理する範囲を指定する事も出来ます。
指定の方法は大きく分けて

1. 行数で指定する
2. 正規表現で始まりと終わりを指定する

の二通りの方法がありますが、正規表現で範囲指定するパターンだけ覚えておけばいいでしょう。

あとで書く。

以下を解説。

```
$ jupyter-notebook --ip=0.0.0.0 2>&1 | tee notebook_output.log | sed -n "/^ *http.*8888/s/ *http.*token=//p"
```

### 後方参照

機械学習ではあまり使いませんが普通のプログラミング業務では良く使う物に後方参照があります。

